{% extends "layouts/base.html" %}

{% block page_title %}Thông tin cá nhân{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('index') }}">Tổng quan</a></li>
<li class="breadcrumb-item active">Thông tin cá nhân</li>
{% endblock %}

{% block content %}
<div class="profile-master-container pb-5">
    <!-- Elite Profile Header -->
    <div class="profile-hero mb-5 px-3">
        <div class="hero-surface luxury-card border-0 position-relative overflow-hidden">
            <!-- Modern Mesh Gradient Background -->
            <div class="mesh-gradient"></div>
            <div class="hero-glass-overlay"></div>

            <div class="hero-content d-flex align-items-center justify-content-between p-5">
                <div class="d-flex align-items-center hero-meta-group">
                    <div class="avatar-elite-wrapper shadow-premium">
                        <div class="avatar-glass">
                            <span class="avatar-initial">{{ user.username[0].upper() }}</span>
                        </div>
                    </div>
                    <div class="hero-text ml-4">
                        <div class="d-flex align-items-center mb-2">
                            <h1 class="hero-name font-weight-black text-white mb-0 mr-3">{{ user.username }}</h1>
                            <span class="badge badge-champagne text-dark font-weight-extrabold px-3 py-1 rounded-pill">
                                <i class="fas fa-ribbon mr-1"></i> {{ user.role.name|upper if user.role else 'CORE
                                STAFF' }}
                            </span>
                        </div>
                        <div class="hero-stats-line d-flex align-items-center text-white-50">
                            <div class="meta-item mr-4">
                                <i class="fas fa-fingerprint mr-1"></i> ID: <span class="text-white">#USR-{{ user.id
                                    }}</span>
                            </div>
                            <div class="meta-item">
                                <i class="far fa-calendar-check mr-1"></i> Phục vụ từ: <span class="text-white">{{
                                    user.created_at.strftime('%m/%Y') }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="hero-actions d-none d-lg-block">
                    <div class="glass-badge px-4 py-2 rounded-xl">
                        <div class="d-flex align-items-center">
                            <span class="pulse-dot mr-2"></span>
                            <span class="text-white small font-weight-bold">BẢO MẬT: CẤP CAO</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row px-4">
        <!-- Identity & Service Summary -->
        <div class="col-lg-8">
            <div class="luxury-card border-0 mb-4 h-auto shadow-sm">
                <div class="luxury-card-header bg-white border-bottom-light p-4">
                    <div class="d-flex align-items-center">
                        <div class="premium-icon-box mr-3">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <h4 class="mb-0 font-weight-extrabold tracking-tighter text-dark">Hồ sơ Cán bộ</h4>
                    </div>
                </div>
                <div class="luxury-card-body p-5">
                    <form method="POST" action="{{ url_for('profile') }}">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="label-premium">Tên truy cập định danh</label>
                                <div class="input-shadow-wrap">
                                    <input type="text" class="form-control luxury-input readonly-style"
                                        value="{{ user.username }}" readonly>
                                    <div class="input-accessory"><i class="fas fa-lock"></i></div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="label-premium">Địa chỉ Email xác thực</label>
                                <input type="email" class="form-control luxury-input" name="email"
                                    value="{{ user.email }}" required @focus="this.select()">
                            </div>
                        </div>

                        <div class="row mt-2">
                            <div class="col-md-6 mb-4">
                                <label class="label-premium">Khởi tạo & Vận hành</label>
                                <div class="p-4 bg-soft-light rounded-2xl border-light d-flex align-items-center">
                                    <div class="meta-icon-sq bg-white text-primary mr-3 shadow-xs">
                                        <i class="fas fa-history"></i>
                                    </div>
                                    <div>
                                        <p class="mb-0 font-weight-bold text-dark small">Phiên làm việc cuối</p>
                                        <p class="mb-0 text-muted font-weight-medium small">{{
                                            user.last_login|vn_date(include_time=True) if user.last_login else 'Khởi tạo
                                            lần đầu' }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="label-premium">Chỉ số tài khoản</label>
                                <div class="p-4 bg-soft-light rounded-2xl border-light d-flex align-items-center">
                                    <div class="meta-icon-sq bg-white text-success mr-3 shadow-xs">
                                        <i class="fas fa-shield-check"></i>
                                    </div>
                                    <div>
                                        <p class="mb-0 font-weight-bold text-dark small">Trạng thái hiện tại</p>
                                        <span
                                            class="badge badge-success-subtle border-success-20 text-success px-3 py-1 rounded-pill small font-weight-bold">Active
                                            Protocol</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="pt-4 mt-2 d-flex align-items-center">
                            <button type="submit"
                                class="btn btn-primary btn-elite px-5 py-3 rounded-xl shadow-lg font-weight-extrabold mr-3">
                                <i class="fas fa-check-circle mr-2"></i> Cập nhật hồ sơ
                            </button>
                            <a href="{{ url_for('settings') }}"
                                class="btn btn-light-ghost px-4 py-3 rounded-xl border font-weight-bold">
                                <i class="fas fa-lock-keyhole mr-2"></i> Bảo mật
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Asset Protocol List -->
            <div class="luxury-card border-0 mb-4 h-auto shadow-sm overflow-hidden">
                <div
                    class="luxury-card-header bg-white border-bottom-light p-4 d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="premium-icon-box bg-slate text-slate mr-3">
                            <i class="fas fa-boxes-stacked"></i>
                        </div>
                        <h4 class="mb-0 font-weight-extrabold tracking-tighter text-dark">Tài sản Đặc thù</h4>
                    </div>
                </div>
                <div class="luxury-card-body p-0">
                    <div class="table-responsive">
                        <table class="table elite-table mb-0">
                            <thead>
                                <tr>
                                    <th class="px-5 py-4 border-0">Danh mục</th>
                                    <th class="py-4 border-0">Mã định danh</th>
                                    <th class="py-4 border-0">Trạng thái</th>
                                    <th class="py-4 border-0 text-right px-5">Ngày cấp</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if assets %}
                                {% for asset in assets %}
                                <tr class="elite-row">
                                    <td class="px-5 py-4">
                                        <div class="d-flex align-items-center">
                                            <div class="asset-marker mr-3"></div>
                                            <div class="asset-meta">
                                                <h6 class="mb-0 font-weight-bold text-dark">{{ asset.name }}</h6>
                                                <small class="text-muted">{{ asset.asset_type.name if asset.asset_type
                                                    else 'Chưa phân loại' }}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="py-4"><code class="code-elite">{{ asset.device_code or 'N/A' }}</code>
                                    </td>
                                    <td class="py-4">
                                        <span
                                            class="status-marker marker-{{ 'active' if asset.status == 'active' else 'maintenance' if asset.status == 'maintenance' else 'default' }}">
                                            {{ asset.status|status_vi }}
                                        </span>
                                    </td>
                                    <td class="py-4 text-right px-5 text-muted font-weight-medium small">{{
                                        asset.created_at.strftime('%d/%m/%Y') }}</td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr>
                                    <td colspan="4" class="p-5 text-center">
                                        <div class="empty-state py-4">
                                            <div class="empty-icon mb-3 opacity-20"><i class="fas fa-inbox fa-4x"></i>
                                            </div>
                                            <h6 class="font-weight-bold text-muted">Chưa có dữ liệu bàn giao</h6>
                                        </div>
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Summary Sidebar -->
        <div class="col-lg-4">
            <!-- Professional Stats Cards - Custom Gradients -->
            <div class="stat-group mb-4">
                <div class="stat-card luxury-card mb-4 border-0 p-4 bg-deep-sea text-white h-auto overflow-hidden">
                    <div class="stat-card-inner position-relative" style="z-index: 2;">
                        <span
                            class="text-uppercase tracking-widest font-weight-bold text-white-50 small mb-3 d-block">Định
                            mức Tài sản</span>
                        <div class="d-flex align-items-end">
                            <h2 class="font-weight-black mb-0" style="font-size: 3.5rem;">{{ asset_count }}</h2>
                            <span class="ml-2 mb-2 font-weight-bold text-white-50">Unit-X</span>
                        </div>
                    </div>
                    <i class="fas fa-shield-halved stat-card-icon"></i>
                </div>

                <div class="stat-card luxury-card mb-4 border-0 p-4 bg-champagne text-dark h-auto overflow-hidden">
                    <div class="stat-card-inner position-relative" style="z-index: 2;">
                        <span
                            class="text-uppercase tracking-widest font-weight-bold text-dark-50 small mb-3 d-block">Chỉ
                            số Bảo trì</span>
                        <div class="d-flex align-items-end">
                            <h2 class="font-weight-black mb-0" style="font-size: 3.5rem;">{{ maintenance_count }}</h2>
                            <span class="ml-2 mb-2 font-weight-bold text-dark-50">Tập tệp</span>
                        </div>
                    </div>
                    <i class="fas fa-screwdriver-wrench stat-card-icon-dark"></i>
                </div>
            </div>

            <!-- Elite Quick Menu -->
            <div class="luxury-card border-0 shadow-sm">
                <div class="luxury-card-header bg-white border-bottom-light p-4">
                    <h5 class="mb-0 font-weight-extrabold text-dark tracking-tighter">Bảng Điều khiển Nhanh</h5>
                </div>
                <div class="luxury-card-body p-0">
                    <div class="quick-menu-list">
                        <a href="{{ url_for('assets') }}?user_id={{ user.id }}"
                            class="menu-item p-4 d-flex align-items-center">
                            <div class="menu-icon bg-primary-soft text-primary mr-3"><i
                                    class="fas fa-magnifying-glass-chart"></i></div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 font-weight-bold text-dark">Kiểm tra Trạng thái</h6>
                                <p class="mb-0 text-xs text-muted">Dữ liệu thời gian thực</p>
                            </div>
                            <i class="fas fa-chevron-right text-muted x-small"></i>
                        </a>
                        <a href="{{ url_for('maintenance_list') }}"
                            class="menu-item p-4 d-flex align-items-center border-top-light">
                            <div class="menu-icon bg-warning-soft text-warning mr-3"><i class="fas fa-microchip"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 font-weight-bold text-dark">Báo cáo Vận hành</h6>
                                <p class="mb-0 text-xs text-muted">Lịch sử sự vụ & kỹ thuật</p>
                            </div>
                            <i class="fas fa-chevron-right text-muted x-small"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* --- Elite Profile Design System --- */

    .profile-master-container {
        font-family: 'Inter', sans-serif;
        color: #334155;
    }

    /* Hero Section */
    .hero-surface {
        height: 320px;
        border-radius: 40px;
    }

    .mesh-gradient {
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, #004d26 0%, #006b35 30%, #002e1a 70%, #004d26 100%);
        z-index: 1;
    }

    .hero-glass-overlay {
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top right, rgba(255, 215, 0, 0.15), transparent 60%);
        z-index: 2;
    }

    .hero-content {
        position: relative;
        z-index: 10;
        height: 100%;
    }

    /* Advanced Avatar Styling */
    .avatar-elite-wrapper {
        width: 180px;
        height: 180px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(12px);
        border-radius: 54px;
        /* Super-ellipse */
        border: 1px solid rgba(255, 255, 255, 0.3);
        overflow: hidden;
    }

    .avatar-glass {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        border-radius: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: inset 0 2px 10px rgba(255, 255, 255, 0.2);
    }

    .avatar-initial {
        font-size: 5rem;
        font-weight: 900;
        color: white;
        text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .hero-name {
        font-size: 3rem;
        letter-spacing: -2px;
    }

    .badge-champagne {
        background-color: #fce7bb;
        color: #92400e;
        border: 1px solid #fde68a;
    }

    .pulse-dot {
        width: 8px;
        height: 8px;
        background-color: #10b981;
        border-radius: 50%;
        box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.3);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            transform: scale(0.95);
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
        }

        70% {
            transform: scale(1);
            box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
        }

        100% {
            transform: scale(0.95);
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
        }
    }

    /* Forms & UI Elements */
    .premium-icon-box {
        width: 50px;
        height: 50px;
        background-color: #f1f5f9;
        color: var(--primary);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }

    .label-premium {
        font-size: 0.7rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #94a3b8;
        margin-bottom: 0.75rem;
        display: block;
    }

    .input-shadow-wrap {
        position: relative;
    }

    .readonly-style {
        background-color: #f8fafc !important;
        border-color: #f1f5f9;
        color: #64748b;
        padding-right: 45px;
    }

    .input-accessory {
        position: absolute;
        right: 18px;
        top: 50%;
        transform: translateY(-50%);
        color: #cbd5e1;
        font-size: 0.8rem;
    }

    .bg-soft-light {
        background-color: #fbfcfe;
    }

    .rounded-2xl {
        border-radius: 24px;
    }

    .border-light {
        border: 1.5px solid #f1f5f9;
    }

    .btn-elite {
        background: linear-gradient(135deg, var(--primary) 0%, #006331 100%);
        border: none;
        box-shadow: 0 15px 35px -10px rgba(0, 77, 38, 0.4);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn-elite:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 20px 45px -10px rgba(0, 77, 38, 0.5);
    }

    /* Elite Table */
    .elite-table thead th {
        background-color: #f8fafc;
        color: #64748b;
        text-transform: uppercase;
        font-size: 0.7rem;
        font-weight: 800;
        letter-spacing: 0.1em;
    }

    .elite-row {
        transition: all 0.2s ease;
    }

    .elite-row:hover {
        background-color: #fbfcfe;
    }

    .asset-marker {
        width: 4px;
        height: 40px;
        background-color: var(--primary);
        border-radius: 10px;
    }

    .code-elite {
        background-color: #f1f5f9;
        color: #3b82f6;
        padding: 4px 10px;
        border-radius: 8px;
        font-family: 'JetBrains Mono', monospace;
        font-weight: 700;
    }

    .status-marker {
        padding: 6px 14px;
        border-radius: 99px;
        font-size: 0.7rem;
        font-weight: 800;
        letter-spacing: 0.05em;
        background-color: #f1f5f9;
    }

    .marker-active {
        background-color: #dcfce7;
        color: #166534;
    }

    .marker-maintenance {
        background-color: #fef3c7;
        color: #92400e;
    }

    /* Stats Cards */
    .bg-deep-sea {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .bg-champagne {
        background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
    }

    .stat-card-icon {
        position: absolute;
        right: -20px;
        bottom: -20px;
        font-size: 8rem;
        opacity: 0.05;
        transform: rotate(-15deg);
    }

    .stat-card-icon-dark {
        position: absolute;
        right: -20px;
        bottom: -20px;
        font-size: 8rem;
        opacity: 0.1;
        transform: rotate(-15deg);
        color: #ca8a04;
    }

    /* Custom Components */
    .menu-item {
        transition: all 0.2s ease;
        text-decoration: none !important;
    }

    .menu-item:hover {
        background-color: #f8fafc;
        padding-left: 3rem !important;
    }

    .menu-icon {
        width: 48px;
        height: 48px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        flex-shrink: 0;
    }

    @media (max-width: 991px) {
        .profile-hero {
            margin-top: 10px;
        }

        .hero-surface {
            height: auto;
            border-radius: 30px;
        }

        .hero-content {
            flex-direction: column;
            align-items: flex-start !important;
        }

        .avatar-elite-wrapper {
            width: 140px;
            height: 140px;
        }
    }
</style>
{% endblock %}