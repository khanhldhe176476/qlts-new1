{% extends "layouts/base.html" %}

{% block content %}
<!-- Welcome Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="luxury-card shadow-sm border-0"
            style="background: linear-gradient(135deg, var(--white) 0%, #f1f5f9 100%);">
            <div class="luxury-card-body p-4 d-flex align-items-center">
                <div class="welcome-icon mr-4 bg-primary-light p-3" style="border-radius: 20px;">
                    <i class="fas fa-shield-alt fa-2x text-primary"></i>
                </div>
                <div>
                    <h2 class="font-weight-bold text-dark mb-0">Xin chào, {{ session.username or 'Khách' }}!</h2>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Stats Rows -->
<div class="row">
    <!-- Row 1 -->
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-info p-3" style="border-radius: 14px; background: #e0f2fe;">
                        <i class="fas fa-box fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Tổng tài sản</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.total_assets }}</h3>
                <a href="{{ url_for('assets') }}" class="text-xs font-weight-bold text-info text-uppercase">Danh sách <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-success p-3" style="border-radius: 14px; background: #dcfce7;">
                        <i class="fas fa-check-circle fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Đang sử dụng</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.active_assets }}</h3>
                <a href="{{ url_for('assets', status='active') }}"
                    class="text-xs font-weight-bold text-success text-uppercase">Đang vận hành <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-warning p-3" style="border-radius: 14px; background: #fef3c7;">
                        <i class="fas fa-tools fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Yêu cầu bảo
                        trì</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.maintenance_count }}</h3>
                <a href="{{ url_for('maintenance_list') }}"
                    class="text-xs font-weight-bold text-warning text-uppercase">Xem yêu cầu <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-primary p-3"
                        style="border-radius: 14px; background: var(--primary-light);">
                        <i class="fas fa-users fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Cán bộ / CS</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.total_users }}</h3>
                <a href="{{ url_for('users') }}" class="text-xs font-weight-bold text-primary text-uppercase">Nhân sự <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <!-- Row 2 -->
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-danger p-3" style="border-radius: 14px; background: #fee2e2;">
                        <i class="fas fa-tags fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Loại tài sản</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.total_asset_types }}</h3>
                <a href="{{ url_for('asset_types') }}" class="text-xs font-weight-bold text-danger text-uppercase">Danh
                    mục <i class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-secondary p-3" style="border-radius: 14px; background: #f1f5f9;">
                        <i class="fas fa-trash-alt fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Đã thanh lý</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.disposed_assets if stats.disposed_assets is defined else 0 }}
                </h3>
                <a href="{{ url_for('assets', status='other') }}"
                    class="text-xs font-weight-bold text-secondary text-uppercase">Lịch sử <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-indigo p-3" style="border-radius: 14px; background: #e0e7ff;">
                        <i class="fas fa-wrench fa-lg" style="color: #4f46e5;"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Đang bảo trì</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.maintenance_assets }}</h3>
                <a href="{{ url_for('assets', status='maintenance') }}" class="text-xs font-weight-bold text-uppercase"
                    style="color: #4f46e5;">Chi tiết <i class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-success p-3" style="border-radius: 14px; background: #f0fdf4;">
                        <i class="fas fa-file-invoice-dollar fa-lg" style="color: #16a34a;"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Chi phí bảo
                        trì</span>
                </div>
                <h3 class="font-weight-bold mb-1" style="font-size: 1.25rem;">{{
                    stats.total_maintenance_cost|currency
                    if stats.total_maintenance_cost else "0 VNĐ" }}</h3>
                <a href="{{ url_for('maintenance_list', status='completed', has_cost=1) }}"
                    class="text-xs font-weight-bold text-success text-uppercase">Chi tiết <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Assets Table -->
    <div class="col-lg-8 mb-4">
        <div class="luxury-card border-0">
            <div class="luxury-card-header border-0 bg-white">
                <h5 class="luxury-card-title">Cập nhật tài sản gần đây</h5>
                <a href="{{ url_for('assets') }}" class="btn btn-sm text-primary font-weight-bold">Tất cả <i
                        class="fas fa-arrow-right ml-1"></i></a>
            </div>
            <div class="p-0">
                <div class="table-responsive">
                    <table class="luxury-table">
                        <thead>
                            <tr>
                                <th>Tên tài sản</th>
                                <th>Mã số</th>
                                <th>Trạng thái</th>
                                <th>Giá trị</th>
                                <th class="text-right">Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for asset in assets[:6] %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="bg-light p-2 mr-3" style="border-radius: 8px;">
                                            <i class="fas fa-laptop-code text-secondary"></i>
                                        </div>
                                        <span class="font-weight-bold text-dark">{{ asset.name }}</span>
                                    </div>
                                </td>
                                <td><span class="text-muted small">{{ asset.device_code or 'N/A' }}</span></td>
                                <td>
                                    {% if asset.status == 'active' %}
                                    <span class="luxury-badge badge-success">Hoạt động</span>
                                    {% elif asset.status == 'maintenance' %}
                                    <span class="luxury-badge badge-warning">Bảo trì</span>
                                    {% else %}
                                    <span class="luxury-badge badge-danger">Ngừng dùng</span>
                                    {% endif %}
                                </td>
                                <td><span class="font-weight-bold">{{ asset.price|currency }}</span></td>
                                <td class="text-right">
                                    <a href="{{ url_for('edit_asset', id=asset.id) }}"
                                        class="btn btn-sm btn-light p-2 mr-1" style="border-radius: 8px;"><i
                                            class="fas fa-pencil-alt text-primary"></i></a>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="text-center py-5 text-muted">Chưa có dữ liệu mới.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-lg-4 mb-4">
        <div class="luxury-card border-0">
            <div class="luxury-card-header bg-white border-0">
                <h5 class="luxury-card-title">Thao tác nhanh</h5>
            </div>
            <div class="luxury-card-body pt-0">
                <div class="d-grid gap-3">
                    <a href="{{ url_for('add_asset') }}" class="btn btn-luxury btn-light w-100 text-left mb-3 p-3"
                        style="background: #f8fafc; border: 1px solid #e2e8f0;">
                        <i class="fas fa-plus-circle text-primary"></i>
                        <div class="ml-2">
                            <span class="d-block font-weight-bold text-dark">Thêm tài sản mới</span>
                            <small class="text-muted">Đăng ký thiết bị vào hệ thống</small>
                        </div>
                    </a>
                    <a href="{{ url_for('transfer_list') }}" class="btn btn-luxury btn-light w-100 text-left mb-3 p-3"
                        style="background: #f8fafc; border: 1px solid #e2e8f0;">
                        <i class="fas fa-exchange-alt text-info"></i>
                        <div class="ml-2">
                            <span class="d-block font-weight-bold text-dark">Bàn giao & Điều động</span>
                            <small class="text-muted">Chuyển quyền sử dụng tài sản</small>
                        </div>
                    </a>
                    <a href="{{ url_for('maintenance_list') }}"
                        class="btn btn-luxury btn-light w-100 text-left mb-3 p-3"
                        style="background: #f8fafc; border: 1px solid #e2e8f0;">
                        <i class="fas fa-clipboard-check text-success"></i>
                        <div class="ml-2">
                            <span class="d-block font-weight-bold text-dark">Báo cáo bảo trì</span>
                            <small class="text-muted">Theo dõi lịch sửa chữa, bảo dưỡng</small>
                        </div>
                    </a>
                    <a href="{{ url_for('reports_dashboard') }}" class="btn btn-luxury btn-light w-100 text-left p-3"
                        style="background: #f8fafc; border: 1px solid #e2e8f0;">
                        <i class="fas fa-file-invoice text-warning"></i>
                        <div class="ml-2">
                            <span class="d-block font-weight-bold text-dark">Kết xuất báo cáo</span>
                            <small class="text-muted">Tổng hợp dữ liệu theo thông tư</small>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .icon-circle {
        transition: transform 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
    }

    .luxury-card:hover .icon-circle {
        transform: scale(1.1);
    }

    .d-grid {
        display: grid;
    }

    .gap-3 {
        grid-gap: 1rem;
    }

    .btn-luxury {
        text-align: left;
        justify-content: flex-start;
        display: flex;
        align-items: center;
        border-radius: 12px;
    }
</style>
{% endblock %}