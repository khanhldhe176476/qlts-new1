{% extends "layouts/base.html" %}

{% block page_title %}{% endblock %}

{% block breadcrumb %}{% endblock %}

{% block content %}
<!-- Hero banner with background image -->
<div class="page-hero mb-3">
  <div class="overlay"></div>
  <div class="hero-content">
    <h2>Xin chào, {{ session.username or 'Khách' }}!</h2>
    <p>Chào mừng đến hệ thống quản lý tài sản. Chúc bạn một ngày hiệu quả.</p>
  </div>
  
</div>
<!-- Info boxes -->
<div class="row">
    <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
            <div class="inner">
                <h3>{{ stats.total_assets }}</h3>
                <p>Tổng tài sản</p>
            </div>
            <div class="icon">
                <i class="fas fa-box"></i>
            </div>
            <a href="{{ url_for('assets', status='active') }}" class="small-box-footer">
                Xem chi tiết <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

    <div class="col-lg-3 col-6">
        <div class="small-box bg-success clickable" data-href="{{ url_for('assets', status='active') }}">
            <div class="inner">
                <h3>{{ stats.active_assets }}</h3>
                <p>Tài sản đang sử dụng</p>
            </div>
            <div class="icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <a href="{{ url_for('assets', status='active') }}" class="small-box-footer">
                Xem chi tiết <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

    <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
            <div class="inner">
                <h3>{{ stats.total_asset_types }}</h3>
                <p>Loại tài sản</p>
            </div>
            <div class="icon">
                <i class="fas fa-tags"></i>
            </div>
            <a href="{{ url_for('asset_types') }}" class="small-box-footer">
                Xem chi tiết <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>

    <div class="col-lg-3 col-6">
        <div class="small-box bg-danger">
            <div class="inner">
                <h3>{{ stats.total_users }}</h3>
                <p>Người dùng</p>
            </div>
            <div class="icon">
                <i class="fas fa-users"></i>
            </div>
            <a href="{{ url_for('users') }}" class="small-box-footer">
                Xem chi tiết <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
</div>

<!-- Thống kê thiết bị theo loại -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title"><i class="fas fa-chart-pie"></i> Thống kê thiết bị theo loại</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                {% if stats.asset_type_stats %}
                <div class="row">
                    {% for stat in stats.asset_type_stats %}
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="info-box hover-shadow info-box-clickable" onclick="window.location.href='{{ url_for('assets') }}?type_id={{ stat.type_id }}'">
                            <span class="info-box-icon bg-info elevation-1">
                                <i class="fas {{ stat.icon }}"></i>
                            </span>
                            <div class="info-box-content">
                                <span class="info-box-text"><strong>{{ stat.type_name }}</strong></span>
                                <span class="info-box-number">
                                    <span class="badge badge-primary badge-lg">{{ stat.total_count }}</span> thiết bị
                                    {% if stat.active_count > 0 %}
                                    <br><small class="text-success"><i class="fas fa-check-circle"></i> {{ stat.active_count }} đang sử dụng</small>
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                    <p class="text-muted">Chưa có dữ liệu thống kê. <a href="{{ url_for('add_asset') }}">Thêm tài sản</a> để xem thống kê.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Recent Assets -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Tài sản gần đây</h3>
                <div class="card-tools">
                    <a href="{{ url_for('add_asset') }}" class="btn btn-primary btn-sm">
                        <i class="fas fa-plus"></i> Thêm tài sản
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if assets %}
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tên tài sản</th>
                                <th>Loại tài sản</th>
                                <th>Người sở hữu</th>
                                <th>Giá</th>
                                <th>Số lượng</th>
                                <th>Trạng thái</th>
                                <th>Ngày tạo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for asset in assets[:10] %}
                            <tr>
                                <td>{{ asset.id }}</td>
                                <td>{{ asset.name }}</td>
                                <td>{{ asset.asset_type.name if asset.asset_type else 'Không có' }}</td>
                                <td>{{ asset.user.username if asset.user else 'Không có' }}</td>
                                <td>{% if asset.price %}{{ "{:,.0f}".format(asset.price) }} VNĐ{% else %}N/A{% endif %}</td>
                                <td>{{ asset.quantity }}</td>
                                <td>
                                    <span
                                        class="badge badge-{{ 'success' if asset.status == 'active' else 'warning' if asset.status == 'maintenance' else 'danger' }}">
                                        {{ 'Đang sử dụng' if asset.status == 'active' else 'Bảo trì' if asset.status ==
                                        'maintenance' else 'Đã thanh lý' }}
                                    </span>
                                </td>
                                <td>{{ asset.created_at|vn_date }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-box fa-3x text-muted mb-3"></i>
                    <p class="text-muted">Chưa có tài sản nào. <a href="{{ url_for('add_asset') }}">Thêm tài sản đầu
                            tiên</a></p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quick actions -->
<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted">Thao tác nhanh</div>
                    <h5 class="mb-2">Thêm tài sản</h5>
                    <a href="{{ url_for('add_asset') }}" class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> Thêm ngay</a>
                </div>
                <i class="fas fa-box fa-2x text-muted"></i>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted">Thao tác nhanh</div>
                    <h5 class="mb-2">Thêm loại tài sản</h5>
                    <a href="{{ url_for('asset_types') }}" class="btn btn-primary btn-sm"><i class="fas fa-tags"></i> Quản lý loại</a>
                </div>
                <i class="fas fa-tags fa-2x text-muted"></i>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted">Thao tác nhanh</div>
                    <h5 class="mb-2">Thêm người dùng</h5>
                    <a href="{{ url_for('add_user') }}" class="btn btn-primary btn-sm"><i class="fas fa-user-plus"></i> Thêm người dùng</a>
                </div>
                <i class="fas fa-users fa-2x text-muted"></i>
            </div>
        </div>
    </div>
</div>
{% endblock %}
