{% extends "layouts/base.html" %}

{% block content %}
<!-- Welcome Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="luxury-card shadow-sm border-0 welcome-gradient overflow-hidden position-relative"
            style="border-radius: 24px;">
            <!-- Subtle Background Graphic -->
            <div class="position-absolute d-none d-lg-block"
                style="right: -30px; bottom: -30px; opacity: 0.04; transform: rotate(-15deg); pointer-events: none;">
                <i class="fas fa-university fa-10x"></i>
            </div>

            <div class="luxury-card-body p-4 p-lg-5 d-flex align-items-center justify-content-between position-relative"
                style="z-index: 1;">
                <div class="d-flex align-items-center">
                    <div class="welcome-icon mr-4 bg-white p-3 shadow-md d-none d-sm-flex align-items-center justify-content-center"
                        style="border-radius: 22px; width: 80px; height: 80px; border: 1.5px solid rgba(0, 77, 38, 0.1);">
                        <i class="fas fa-shield-alt fa-2x text-primary animate-pulse-subtle"></i>
                    </div>
                    <div>
                        <p
                            class="text-xs text-uppercase font-weight-bold text-primary tracking-widest mb-1 opacity-75 d-flex align-items-center">
                            <i class="fas fa-circle text-success mr-2 font-xs animate-flicker"></i>
                            Hệ thống quản trị tài sản chuyên sâu
                        </p>
                        <h2 class="font-weight-extrabold text-dark mb-1" style="font-size: 2rem; letter-spacing: -1px;">
                            Xin chào, <span class="text-primary">{{ session.username or 'Cán bộ' }}</span>!
                        </h2>
                        <p class="mb-0 text-muted font-weight-medium" id="greeting-text">Rất vui được gặp lại bạn. Chúc
                            một ngày làm việc hiệu quả!</p>
                    </div>
                </div>

                <div class="d-none d-md-flex align-items-center">
                    <!-- Timer/Date -->
                    <div class="text-right mr-5 border-right pr-5 border-gray-200">
                        <p class="text-xs text-uppercase font-weight-bold text-muted mb-1 tracking-wider">Thời gian hệ
                            thống</p>
                        <h4 class="font-weight-extrabold mb-0 text-dark"
                            style="font-family: 'Courier New', Courier, monospace; letter-spacing: 1px;">00:00:00</h4>
                        <small class="text-muted font-weight-bold" id="current-date">Ngày {{ today|vn_date }}</small>
                    </div>

                    <!-- Unified Status Hub - Non-wrapping 2-line layout -->
                    <div
                        class="status-hub d-flex align-items-center bg-white px-4 py-3 shadow-sm rounded-xl border border-gray-100 luxury-glass-dark">
                        <div class="status-segment pr-4 mr-4 border-right border-gray-100 d-flex align-items-center">
                            <i class="fas fa-network-wired text-success mr-3" style="font-size: 0.75rem;"></i>
                            <div style="white-space: nowrap;">
                                <p class="text-xs font-weight-bold text-muted mb-0"
                                    style="font-size: 0.6rem; line-height: 1;">Đường truyền</p>
                                <span class="text-xs font-weight-black text-success"
                                    style="line-height: 1.2; font-size: 0.7rem;">ỔN ĐỊNH</span>
                            </div>
                        </div>
                        <div class="status-segment d-flex align-items-center">
                            <i class="fas fa-database text-primary mr-3" style="font-size: 0.75rem;"></i>
                            <div style="white-space: nowrap;">
                                <p class="text-xs font-weight-bold text-muted mb-0"
                                    style="font-size: 0.6rem; line-height: 1;">Cơ sở dữ liệu</p>
                                <span class="text-xs font-weight-black text-primary"
                                    style="line-height: 1.2; font-size: 0.7rem;">ĐỒNG BỘ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Stats Rows -->
<div class="row">
    <!-- Row 1 -->
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-info p-3" style="border-radius: 14px; background: #e0f2fe;">
                        <i class="fas fa-box fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Tổng tài sản</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.total_assets }}</h3>
                <a href="{{ url_for('assets') }}" class="text-xs font-weight-bold text-info text-uppercase">Danh sách <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-success p-3" style="border-radius: 14px; background: #dcfce7;">
                        <i class="fas fa-check-circle fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Đang sử dụng</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.active_assets }}</h3>
                <a href="{{ url_for('assets', status='active') }}"
                    class="text-xs font-weight-bold text-success text-uppercase">Đang vận hành <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-warning p-3" style="border-radius: 14px; background: #fef3c7;">
                        <i class="fas fa-tools fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Yêu cầu bảo
                        trì</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.maintenance_count }}</h3>
                <a href="{{ url_for('maintenance_list') }}"
                    class="text-xs font-weight-bold text-warning text-uppercase">Xem yêu cầu <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-primary p-3"
                        style="border-radius: 14px; background: var(--primary-light);">
                        <i class="fas fa-users fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Cán bộ / CS</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.total_users }}</h3>
                <a href="{{ url_for('users') }}" class="text-xs font-weight-bold text-primary text-uppercase">Nhân sự <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <!-- Row 2 -->
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-danger p-3" style="border-radius: 14px; background: #fee2e2;">
                        <i class="fas fa-tags fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Loại tài sản</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.total_asset_types }}</h3>
                <a href="{{ url_for('asset_types') }}" class="text-xs font-weight-bold text-danger text-uppercase">Danh
                    mục <i class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-secondary p-3" style="border-radius: 14px; background: #f1f5f9;">
                        <i class="fas fa-trash-alt fa-lg"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Đã thanh lý</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.disposed_assets if stats.disposed_assets is defined else 0 }}
                </h3>
                <a href="{{ url_for('assets', status='other') }}"
                    class="text-xs font-weight-bold text-secondary text-uppercase">Lịch sử <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-indigo p-3" style="border-radius: 14px; background: #e0e7ff;">
                        <i class="fas fa-wrench fa-lg" style="color: #4f46e5;"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Đang bảo trì</span>
                </div>
                <h3 class="font-weight-bold mb-1">{{ stats.maintenance_assets }}</h3>
                <a href="{{ url_for('assets', status='maintenance') }}" class="text-xs font-weight-bold text-uppercase"
                    style="color: #4f46e5;">Chi tiết <i class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="luxury-card h-100 border-0">
            <div class="luxury-card-body">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="icon-circle text-success p-3" style="border-radius: 14px; background: #f0fdf4;">
                        <i class="fas fa-file-invoice-dollar fa-lg" style="color: #16a34a;"></i>
                    </div>
                    <span class="text-xs font-weight-bold text-uppercase tracking-wider text-muted">Chi phí bảo
                        trì</span>
                </div>
                <h3 class="font-weight-bold mb-1" style="font-size: 1.25rem;">{{
                    stats.total_maintenance_cost|currency
                    if stats.total_maintenance_cost else "0 VNĐ" }}</h3>
                <a href="{{ url_for('maintenance_list', status='completed', has_cost=1) }}"
                    class="text-xs font-weight-bold text-success text-uppercase">Chi tiết <i
                        class="fas fa-chevron-right ml-1"></i></a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Assets Table -->
    <div class="col-lg-8 mb-4">
        <div class="luxury-card border-0">
            <div class="luxury-card-header border-0 bg-white">
                <h5 class="luxury-card-title">Cập nhật tài sản gần đây</h5>
                <a href="{{ url_for('assets') }}" class="btn btn-sm text-primary font-weight-bold">Tất cả <i
                        class="fas fa-arrow-right ml-1"></i></a>
            </div>
            <div class="p-0">
                <div class="table-responsive">
                    <table class="luxury-table">
                        <thead>
                            <tr>
                                <th>Tên tài sản</th>
                                <th>Mã số</th>
                                <th class="text-center">Trạng thái</th>
                                <th>Giá trị</th>
                                <th class="text-right">Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for asset in assets[:6] %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="bg-light p-2 mr-3" style="border-radius: 8px;">
                                            <i class="fas fa-laptop-code text-secondary"></i>
                                        </div>
                                        <span class="font-weight-bold text-dark">{{ asset.name }}</span>
                                    </div>
                                </td>
                                <td><span class="text-muted small">{{ asset.device_code or 'N/A' }}</span></td>
                                <td class="text-center">
                                    {% if asset.status == 'active' %}
                                    <span class="luxury-badge badge-success">Hoạt động</span>
                                    {% elif asset.status == 'maintenance' %}
                                    <span class="luxury-badge badge-warning">Bảo trì</span>
                                    {% else %}
                                    <span class="luxury-badge badge-danger">Ngừng dùng</span>
                                    {% endif %}
                                </td>
                                <td><span class="font-weight-bold">{{ asset.price|currency }}</span></td>
                                <td class="text-right">
                                    <a href="{{ url_for('edit_asset', id=asset.id) }}"
                                        class="btn btn-sm btn-light p-2 mr-1" style="border-radius: 8px;"><i
                                            class="fas fa-pencil-alt text-primary"></i></a>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="text-center py-5 text-muted">Chưa có dữ liệu mới.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-lg-4 mb-4">
        <div class="luxury-card border-0">
            <div class="luxury-card-header bg-white border-0">
                <h5 class="luxury-card-title">Thao tác nhanh</h5>
            </div>
            <div class="luxury-card-body pt-0">
                <div class="d-grid gap-3">
                    <a href="{{ url_for('add_asset') }}" class="btn btn-luxury-action mb-3 shadow-xs">
                        <div class="action-icon bg-primary-soft text-primary"><i class="fas fa-plus"></i></div>
                        <div class="ml-3">
                            <span class="d-block font-weight-extrabold text-dark small tracking-tight">Thêm tài sản
                                mới</span>
                            <p class="text-xs text-muted mb-0">Đăng ký thiết bị vào hệ thống</p>
                        </div>
                    </a>
                    <a href="{{ url_for('transfer_list') }}" class="btn btn-luxury-action mb-3 shadow-xs">
                        <div class="action-icon bg-info-soft text-info"><i class="fas fa-right-left"></i></div>
                        <div class="ml-3">
                            <span class="d-block font-weight-extrabold text-dark small tracking-tight">Bàn giao & Điều
                                động</span>
                            <p class="text-xs text-muted mb-0">Chuyển quyền sử dụng tài sản</p>
                        </div>
                    </a>
                    <a href="{{ url_for('maintenance_list') }}" class="btn btn-luxury-action mb-3 shadow-xs">
                        <div class="action-icon bg-success-soft text-success"><i class="fas fa-screwdriver-wrench"></i>
                        </div>
                        <div class="ml-3">
                            <span class="d-block font-weight-extrabold text-dark small tracking-tight">Báo cáo bảo
                                trì</span>
                            <p class="text-xs text-muted mb-0">Theo dõi lịch sửa chữa, bảo dưỡng</p>
                        </div>
                    </a>
                    <a href="{{ url_for('reports_dashboard') }}" class="btn btn-luxury-action shadow-xs">
                        <div class="action-icon bg-warning-soft text-warning"><i class="fas fa-file-export"></i></div>
                        <div class="ml-3">
                            <span class="d-block font-weight-extrabold text-dark small tracking-tight">Kết xuất báo
                                cáo</span>
                            <p class="text-xs text-muted mb-0">Tổng hợp dữ liệu theo thông tư</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .icon-circle {
        transition: transform 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
    }

    .luxury-card:hover .icon-circle {
        transform: scale(1.1);
    }

    .d-grid {
        display: grid;
    }

    .gap-3 {
        grid-gap: 1rem;
    }

    .btn-luxury-action {
        text-align: left;
        justify-content: flex-start;
        display: flex;
        align-items: center;
        border-radius: 16px;
        padding: 1.25rem;
        background: #fbfcfe;
        border: 1px solid #f1f5f9;
        transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
        width: 100%;
    }

    .btn-luxury-action:hover {
        transform: translateY(-3px) scale(1.01);
        background: #fff;
        border-color: var(--primary);
        box-shadow: 0 10px 25px -5px rgba(0, 77, 38, 0.1);
    }

    .action-icon {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        flex-shrink: 0;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Update Clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            const clockElement = document.getElementById('current-clock');
            if (clockElement) {
                clockElement.textContent = `${hours}:${minutes}:${seconds}`;
            }

            // Dynamic Greeting
            const greetingElement = document.getElementById('greeting-text');
            if (greetingElement) {
                const hour = now.getHours();
                let message = "";
                if (hour >= 5 && hour < 12) {
                    message = "Chào buổi sáng! Chúc bạn khởi đầu ngày mới tràn đầy năng lượng.";
                } else if (hour >= 12 && hour < 18) {
                    message = "Chào buổi chiều! Hy vọng công việc của bạn đang diễn ra thuận lợi.";
                } else if (hour >= 18 && hour < 22) {
                    message = "Chào buổi tối! Hãy dành thời gian thư giãn sau một ngày làm việc.";
                } else {
                    message = "Hệ thống vẫn đang hoạt động ổn định. Chúc bạn một đêm ngon giấc!";
                }
                greetingElement.textContent = message;
            }
        }

        setInterval(updateClock, 1000);
        updateClock();
    });
</script>
{% endblock %}